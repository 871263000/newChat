webpackJsonp([0],{155:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=a(1),s=a(2),i=(a(32),a(9));o.a.component("asyncModal",function(e){a.e(14).then(function(){var t=[a(150)];e.apply(null,t)}.bind(this)).catch(a.oe)}),o.a.component("imgFd",function(e){a.e(3).then(function(){var t=[a(141)];e.apply(null,t)}.bind(this)).catch(a.oe)}),o.a.component("MshowModal",function(e){a.e(1).then(function(){var t=[a(140)];e.apply(null,t)}.bind(this)).catch(a.oe)});var n=0;t.default={data:function(){return{shareShow:!1,p:1,messagesLog:[],scrollHeight:0,showImg:!1,imgfdBoxinfo:"",forwardInfo:{mouseLeftShow:!1,forwardContent:"",forwardId:0,messageOfSelf:!1}}},computed:a.i(s.b)({user:function(e){return e.user},dig:function(e){return e.currentSession},currentSessionType:function(e){return e.currentSessionType}}),props:["show"],methods:{content:function(e,t){return-1!==e.indexOf("-voice-[")?e=e.replace(/-(voice)-\[(.*?)\]/g,function(e,a,o){var s="",i=o.split("|");return o[1]&&(s=t?'<voice class="iconfont-chat" data-content="'+i[1]+'">&#xe604;<i class="playingRight"></i></voice>':'<voice class="iconfont-chat" data-content="'+i[1]+'">&#xe605;<i class="playingLeft"></i></voice>'),s}):a.i(i.b)(e)},loadMroe:function(e){0==e.target.scrollTop&&this.getMessage()},getMessage:function(){var e="",t=this;e="message"==this.currentSessionType?"friend":"group",this.$http.get("/omsIm/demo/json/getList.php",{params:{p:this.p,id:this.dig.id,type:e,class:"page"}}).then(function(e){var a=this;e.data&&(t.p++,t.messagesLog.unshift.apply(this.messagesLog,e.data.data.reverse()),a.$nextTick(function(){t.$refs.scrollBox.scrollTop=t.$refs.scroll.offsetHeight-n,n=t.$refs.scroll.offsetHeight}))})},imgFd:function(e){if("IMG"==e.target.nodeName){var t=e.target.src;this.$emit("imgShow",t)}"VOICE"==e.target.nodeName&&(this.$refs.audio.onended=function(){_this.playComplete=!1,e.target.children[0].style.display="none"},this.$refs.audio.src=e.target.getAttribute("data-content"),e.target.children[0].style.display="inline-block",this.$refs.audio.play(),this.playComplete=!0)},close:function(){this.$emit("close")},mouseLeft:function(e,t,a,o){var s=e.pageX,i=e.pageY;this.forwardInfo.mouseLeftShow=!0,this.$nextTick(function(){this.$refs.mouseLeft.style.top=i+2+"px",this.$refs.mouseLeft.style.left=s+2+"px"}),this.forwardInfo.forwardContent=t,this.forwardInfo.forwardId=a,this.forwardInfo.messageOfSelf=o},forward:function(e){this.shareShow=!0,this.shareContent=e,this.forwardInfo.mouseLeftShow=!1},share:function(e){var t={};for(var a in e)return t.senderId=this.user.id,t.name=e[a].name,t.img=e[a].avatar,t.type=e[a].type,t.id=e[a].id,t.content=this.shareContent,t.content?(this.$store.dispatch("batchSendMessage",t),void alert("已分享！")):(alert("分享失败！"),!1)}},created:function(){var e=this;document.addEventListener("click",function(t){console.log(343),e.forwardInfo.mouseLeftShow=!1}),this.$nextTick(function(){this.getMessage()})}},o.a.directive("scroll-bottom",function(e){o.a.nextTick(function(){for(var t=e.getElementsByTagName("img"),a=0,o=0,s=0;s<=t.length-1;s++)"chat-img"==t[s].getAttribute("class")&&(a++,t[s].onload=function(){i()});var i=function(){++o==a&&(e.scrollTop=e.scrollHeight-e.clientHeight)};e.scrollTop=e.scrollHeight-e.clientHeight})})},165:function(e,t,a){t=e.exports=a(137)(!1),t.push([e.i,".chat-file i{width:56px;height:56px;display:inline-block;font-size:58px;text-align:center;line-height:56px;padding:5px;color:#000}.chat-file .chat-share{position:absolute;font-size:20px;top:0;right:0;padding:10px;cursor:pointer}voice{cursor:pointer;font-size:28px;height:35px;line-height:35px}.playingLeft{right:-25px}.playingLeft,.playingRight{display:none;position:absolute;top:17px;width:10px;height:10px;border-radius:10px;background-color:red}.playingRight{left:-25px}",""])},166:function(e,t,a){t=e.exports=a(137)(!1),t.push([e.i,'.groupName[data-v-0e6a421e]{color:#908f8f;padding:5px}@media screen and (max-width:500px){.message-log[data-v-0e6a421e]{padding:5px;overflow:auto;height:100%}}@media screen and (min-width:500px){.message-log[data-v-0e6a421e]{padding:5px;overflow:auto;height:400px}.mouseLeft[data-v-0e6a421e]{position:fixed;z-index:999999;width:100px;background-color:#fff;text-align:center;box-shadow:0 0 10px #3c3b3b;cursor:pointer}.mouseLeft ul li[data-v-0e6a421e]{padding:10px;border-bottom:1px solid #ccc;margin:0}}.message-log ul[data-v-0e6a421e]::-webkit-scrollbar{width:100px;display:block;width:10px;height:10px}.message-log ul[data-v-0e6a421e]::-webkit-scrollbar-track{background:transparent}.message-log ul[data-v-0e6a421e]::-webkit-scrollbar-thumb{background:rgba(0,0,0,.5);border-radius:10px}.message-log ul[data-v-0e6a421e]::-webkit-scrollbar-corner{background:#82afff}.message-log ul[data-v-0e6a421e]::-webkit-scrollbar-resizer{background:#ff0bee}.message-log ul[data-v-0e6a421e]::scrollbar{width:100px;display:block;width:10px;height:10px}.message-log ul[data-v-0e6a421e]::scrollbar-track{background:transparent}.message-log ul[data-v-0e6a421e]::scrollbar-thumb{background:rgba(0,0,0,.5);border-radius:10px}.message-log ul[data-v-0e6a421e]::scrollbar-corner{background:#82afff}.message-log ul[data-v-0e6a421e]::scrollbar-resizer{background:#ff0bee}.message-log li[data-v-0e6a421e]{margin-bottom:15px}.message-log .time[data-v-0e6a421e]{margin:7px 0;text-align:center}.message-log .time>span[data-v-0e6a421e]{display:inline-block;padding:0 18px;font-size:12px;color:#fff;border-radius:2px;background-color:#dcdcdc}.message-log .avatar[data-v-0e6a421e]{float:left;margin:0 10px 0 0;border-radius:3px}.message-log .text[data-v-0e6a421e]{display:inline-block;position:relative;padding:0 10px;max-width:calc(100% - 80px);min-height:30px;line-height:2;font-size:16px;text-align:left;word-break:break-all;background-color:#fafafa;border-radius:4px}.message-log .text[data-v-0e6a421e]:before{content:" ";position:absolute;top:9px;right:100%;border:6px solid transparent;border-right-color:#fafafa}.message-log .self[data-v-0e6a421e]{text-align:right}.message-log .self .avatar[data-v-0e6a421e]{float:right;margin:0 0 0 10px}.message-log .self .text[data-v-0e6a421e]{background-color:#b2e281}.message-log .self .text[data-v-0e6a421e]:before{right:inherit;left:100%;border-right-color:transparent;border-left-color:#b2e281}',""])},182:function(e,t,a){var o=a(165);"string"==typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);a(138)("5bb7b921",o,!0)},183:function(e,t,a){var o=a(166);"string"==typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);a(138)("7aaa5226",o,!0)},199:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("audio",{ref:"audio"}),e._v(" "),e.forwardInfo.mouseLeftShow?a("div",{ref:"mouseLeft",staticClass:"mouseLeft"},[a("ul",[e.forwardInfo.messageOfSelf?a("li",{on:{click:function(t){e.revoke()}}},[e._v("撤回")]):e._e(),e._v(" "),a("li",{on:{click:function(t){e.forward(e.forwardInfo.forwardContent)}}},[e._v("转发")])])]):e._e(),e._v(" "),e.showImg?a("imgFd",{attrs:{imgSrc:e.imgfdBoxinfo},on:{close:function(t){e.showImg=!1}}}):e._e(),e._v(" "),e.show?a("asyncModal",{on:{close:e.close}},[a("div",{slot:"header"},[e._v("\r\n\t\t\t与 "+e._s(e.dig.name)+" 的聊天记录\r\n\t\t")]),e._v(" "),a("div",{ref:"scrollBox",staticClass:"message-log",on:{scroll:function(t){e.loadMroe(t)}},slot:"body"},[a("ul",{directives:[{name:"scroll-bottom",rawName:"v-scroll-bottom",value:e.messagesLog,expression:"messagesLog"}],ref:"scroll"},e._l(e.messagesLog,function(t){return a("li",[a("p",{staticClass:"time"},[a("span",[e._v(e._s(t.timestamp))])]),e._v(" "),a("div",{staticClass:"main",class:{self:t.id==e.user.id}},[a("img",{staticClass:"avatar",attrs:{width:"40",height:"40",src:t.id==e.user.id?e.user.img:t.avatar}}),e._v(" "),"groupMessage"==e.currentSessionType&&t.id!=e.user.id?a("div",{staticClass:"groupName"},[e._v(e._s(t.username))]):e._e(),e._v(" "),a("div",{directives:[{name:"oncontextmenu",rawName:"v-oncontextmenu",value:t.content,expression:"item.content"}],staticClass:"text",domProps:{innerHTML:e._s(e.content(t.content,t.id==e.user.id))},on:{contextmenu:function(a){e.mouseLeft(a,t.content,t.id,t.self)},click:function(t){t.stopPropagation(),e.imgFd(t)}}})])])}))])]):e._e(),e._v(" "),e.shareShow?a("MshowModal",{attrs:{group:!0},on:{close:function(t){e.shareShow=!1},selectedMan:e.share}}):e._e()],1)},staticRenderFns:[]}},34:function(e,t,a){a(182),a(183);var o=a(3)(a(155),a(199),"data-v-0e6a421e",null);e.exports=o.exports}});